(this["webpackJsonpreact_redux-list-of-posts"]=this["webpackJsonpreact_redux-list-of-posts"]||[]).push([[0],{32:function(e,t,n){e.exports=n.p+"static/media/delete.d4a3dcc3.svg"},33:function(e,t,n){e.exports=n.p+"static/media/edit.a5ec2c5e.svg"},35:function(e,t,n){e.exports=n(59)},43:function(e,t,n){},56:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){},59:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(18),o=n.n(r),s=n(2),u=n(13),i=n(4),l=(n(43),"https://mate.academy/students-api/"),m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return fetch(l+e,t).then((function(e){if(!e.ok)throw new Error("".concat(e.status,": ").concat(e.statusText));return e.json()}))};var d=n(6),f=n.n(d),b=n(10),p=n(17),E=n(29),v=n(30),O=n(1);function h(e){return m("posts/".concat(e))}function j(e){return m("comments?postId=".concat(e))}var S=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"START_LOADING":return!0;case"FINISH_LOADING":return!1;default:return e}},_=function(e){return{type:"SET_MESSAGE",message:e}},N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MESSAGE":return"object"===typeof t.message?t.message.message:t.message;default:return e}},g={posts:[],post:null,selectedPostId:0,userId:0,users:[]},y=function(e){return{type:"SET_USERID",value:e}},T=function(e){return{type:"SET_POSTID",value:e}},C=function(e){return function(t){t({type:"START_LOADING"}),function(e){return m(e?"posts?userId=".concat(e):"posts")}(e).then((function(e){t({type:"SET_POSTS",posts:e})})).catch((function(e){t(_(e))})).finally((function(){t({type:"FINISH_LOADING"})}))}},I=n(34),D={comments:null,commentsEdit:[],commentEdit:null,commentsHidden:!1,commentsUpdated:!1},P=function(e){return{type:"SET_POST_COMMENTS",comments:e}},w=function(e){return{type:"SET_COMMENT_EDIT",commentEdit:e}},M=function(e){return{type:"SET_COMMENTS_UPDATED",commentsUpdated:e}},A=function(e){!function(e){m("comments",{method:"POST",headers:{"Content-type":"application/json; charset=UTF-8"},body:JSON.stringify(e)})}(e)},x=function(e,t){!function(e,t){m("comments/".concat(e),{method:"PATCH",headers:{"Content-type":"application/json; charset=UTF-8"},body:JSON.stringify(t)})}(e,t)},F=function(e){!function(e){m("comments/".concat(e),{method:"DELETE"})}(e)},U=function(e,t){return e?e.map((function(e){return e.id!==t.id?t:Object(O.a)({},e)})):null},k=Object(p.combineReducers)({loading:S,message:N,postsState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USERID":return Object(O.a)(Object(O.a)({},e),{},{userId:t.value});case"SET_USERS":return Object(O.a)(Object(O.a)({},e),{},{users:t.value});case"SET_POSTS":return Object(O.a)(Object(O.a)({},e),{},{posts:t.posts});case"SET_POST":return Object(O.a)(Object(O.a)({},e),{},{post:t.post});case"SET_POSTID":return Object(O.a)(Object(O.a)({},e),{},{selectedPostId:t.value});default:return e}},commentsState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_POST_COMMENTS":return Object(O.a)(Object(O.a)({},e),{},{comments:t.comments});case"SET_COMMENTS_EDIT":return Object(O.a)(Object(O.a)({},e),{},{commentsEdit:[].concat(Object(I.a)(e.commentsEdit),[t.commentId])});case"SET_COMMENT_EDIT":return Object(O.a)(Object(O.a)({},e),{},{commentEdit:t.commentEdit});case"SET_NEW_COMMENT":return Object(O.a)(Object(O.a)({},e),{},{comments:U(e.comments,t.comment)});case"SET_COMMENTS_HIDDEN":return Object(O.a)(Object(O.a)({},e),{},{commentsHidden:t.commentsHidden});case"SET_COMMENTS_UPDATED":return Object(O.a)(Object(O.a)({},e),{},{commentsUpdated:t.commentsUpdated});default:return e}}}),L=function(e){return e.loading},R=function(e){return e.message},H=function(e){return e.postsState.users},q=function(e){return e.postsState.userId},G=function(e){return e.postsState.posts},z=function(e){return e.postsState.selectedPostId},J=function(e){return e.postsState.post},V=function(e){return e.commentsState.comments},Y=function(e){return e.commentsState.commentsEdit},Z=function(e){return e.commentsState.commentEdit},$=function(e){return e.commentsState.commentsHidden},W=function(e){return e.commentsState.commentsUpdated},B=Object(p.createStore)(k,Object(E.composeWithDevTools)(Object(p.applyMiddleware)(v.a))),K=n(16),Q=n(31),X=n.n(Q),ee=function(){var e=Object(a.useState)(""),t=Object(K.a)(e,2),n=t[0],r=t[1],o=Object(i.e)(),u=Object(i.d)(),l=new URLSearchParams(o.search),m=Object(s.c)(q),d=Object(s.c)(H),f=Object(s.b)(),b=X()((function(e){e&&e.length>0?l.set("query",e):l.delete("query"),u.push({search:l.toString()})}),350);return d?c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"group group--left"},c.a.createElement("label",{htmlFor:"title"},"Title: \xa0"),c.a.createElement("input",{type:"text",name:"title",value:n,placeholder:"Filter by title",onChange:function(e){var t=e.currentTarget.value;r(t),b(t)}})),c.a.createElement("div",{className:"group group--left"},c.a.createElement("label",{htmlFor:"user"},"Select a user: \xa0"),c.a.createElement("select",{name:"user",value:m,onChange:function(e){var t=e.currentTarget.value;Number(t)>0?(l.set("userId",t),f(y(Number(t)))):(l.delete("userId"),f(y(0))),u.push({search:l.toString()})}},c.a.createElement("option",{value:""},"All users"),d.map((function(e){return c.a.createElement("option",{value:e.id,key:e.id},e.name)}))))):c.a.createElement("div",{className:"info"},"No users data")},te=(n(56),c.a.memo((function(e){var t=e.id,n=e.title,a=e.body,r=Object(s.c)(z),o=Object(s.b)();return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"PostsList__item-content"},c.a.createElement("h3",null,n),c.a.createElement("p",null,a)),r!==t?c.a.createElement("button",{type:"button",className:"PostsList__button button",onClick:function(){o(T(t))}},"Open"):c.a.createElement("button",{type:"button",className:"PostsList__button button button--active",onClick:function(){o(T(0)),o(P(null))}},"Close"))}))),ne=c.a.memo((function(e){var t=e.loading,n=e.selectedUserId,r=Object(s.c)(G),o=Object(s.c)(R),u=Object(i.e)(),l=new URLSearchParams(u.search).get("query")||null,m=Object(s.b)();Object(a.useEffect)((function(){m(n>0?C(n):C())}),[n,m]);var d=Object(a.useMemo)((function(){return l?r.filter((function(e){return e.title.includes(l.toLowerCase())})):r}),[r,l]);return c.a.createElement("div",{className:"PostsList"},t&&!o?c.a.createElement("div",{className:"loading"}):c.a.createElement(c.a.Fragment,null,c.a.createElement("h2",null,"Posts:"),c.a.createElement("ul",{className:"PostsList__list"},d.length>0?d.map((function(e){return c.a.createElement("li",{className:"PostsList__item",key:e.id},c.a.createElement(te,e))})):c.a.createElement("p",{className:"info"},"Posts list is empty."))))})),ae=n(32),ce=n.n(ae),re=n(33),oe=n.n(re),se=c.a.memo((function(e){var t=e.postId,n=Object(s.c)(V),r=Object(s.c)(W),o=Object(s.c)(Y),u=Object(s.b)();Object(a.useEffect)((function(){t>0&&u(function(e){return function(t){j(e).then((function(e){t(P(e||null))}))}}(t)),o&&u(w(null)),r&&u(M(!1))}),[t,r,u]);var i=function(){var e=Object(b.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(t);case 2:u(M(!0));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(e){(function(e){return m("comments/".concat(e))})(e).then((function(e){u(w(e))}))};return n?c.a.createElement("ul",{className:"PostDetails__list"},n.map((function(e){return c.a.createElement("li",{className:"PostDetails__list-item",key:e.id},c.a.createElement("span",null,e.body),c.a.createElement("div",null,o.includes(e.id)&&c.a.createElement("button",{type:"button",className:"button button--icon",onClick:function(t){t.preventDefault(),l(e.id)}},c.a.createElement("img",{src:oe.a,alt:"edit icon"})),c.a.createElement("button",{type:"button",className:"button button--icon",onClick:function(t){t.preventDefault(),e.id&&i(e.id)}},c.a.createElement("img",{src:ce.a,alt:"delete icon"}))))}))):c.a.createElement("p",{className:"info"},"No comments")})),ue=(n(57),n(12)),ie=c.a.memo((function(e){var t=e.postId,n=Object(s.c)(Z),r=Object(s.b)(),o={name:n&&n.name?n.name:"",email:n&&n.email?n.email:"",body:n&&n.body?n.body:"",postId:t};Object(a.useEffect)((function(){n?(E.name=n.name,E.email=n.email,E.body=n.body):(h(),d())}),[t,n]);var u=function(e){var t=Object(a.useState)((null===e||void 0===e?void 0:e.initialValues)||{}),n=Object(K.a)(t,2),c=n[0],r=n[1],o=Object(a.useState)({}),s=Object(K.a)(o,2),u=s[0],i=s[1],l=!0,m=function(){var t=Object(b.a)(f.a.mark((function t(n){var a,r,o,s,u,m,d,b,p;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),!(a=null===e||void 0===e?void 0:e.validations)){t.next=8;break}for(o in r={},a)u=c[o],(null===(m=a[o])||void 0===m||null===(s=m.required)||void 0===s?void 0:s.value)&&!u&&(l=!1,r[o]=null===m||void 0===m||null===(d=m.required)||void 0===d?void 0:d.message),(null===(b=null===m||void 0===m?void 0:m.pattern)||void 0===b?void 0:b.value)&&!RegExp(b.value).test(u)&&(l=!1,r[o]=b.message),(null===(p=null===m||void 0===m?void 0:m.custom)||void 0===p?void 0:p.isValid)&&!p.isValid(u)&&(l=!1,r[o]=p.message);if(l){t.next=8;break}return i(r),t.abrupt("return");case 8:i({}),(null===e||void 0===e?void 0:e.onSubmit)&&e.onSubmit();case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{valid:l,data:c,handleChange:function(e){return function(t){var n=t.target.value;r(Object(O.a)(Object(O.a)({},c),{},Object(ue.a)({},e,n)))}},handleTextareaChange:function(e,t){r(Object(O.a)(Object(O.a)({},c),{},Object(ue.a)({},e,t)))},handleSubmit:m,resetData:function(){c&&Object.keys(c).forEach((function(e){r(Object(O.a)(Object(O.a)({},c),{},Object(ue.a)({},e,"")))}))},isEditing:function(){return(null===e||void 0===e?void 0:e.editing)||!1},errors:u}}({editing:!!n,validations:{name:{pattern:{value:"^[A-Za-z]*$",message:"You're not allowed to use special characters or numbers in your name."}},email:{pattern:{value:"^[a-zA-Z0-9]+@[a-zA-Z0-9]+.[A-Za-z]+$",message:"Your email is not valid."}},body:{custom:{isValid:function(e){return e.length<151&&e.length>3},message:"The comment should have from 4 to 150 characters."}}},onSubmit:function(){var e=Object(O.a)(Object(O.a)({},o),{},{name:E.name,email:E.email,body:E.body.replace(/^\s+|\s+$/g,"")});n?j(e):S(e),h()}}),i=u.handleSubmit,l=u.handleChange,m=u.handleTextareaChange,d=u.resetData,p=u.isEditing,E=u.data,v=u.errors,h=function(){E.name="",E.email="",E.body="",o.name="",o.email="",o.body=""},j=function(){var e=Object(b.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(O.a)(Object(O.a)({},t),{},{id:n.id}),e.next=3,x(n.id,a);case 3:r(M(!0));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(b.a)(f.a.mark((function e(t){var n,a,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now().toString(),a=Number(n.substr(n.length-6)),c=Object(O.a)(Object(O.a)({},t),{},{id:a}),e.next=5,A(c);case 5:r(M(!0)),r({type:"SET_COMMENTS_EDIT",commentId:a});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return c.a.createElement("form",{className:"NewCommentForm",onSubmit:function(e){e.preventDefault(),i(e)},method:"POST"},c.a.createElement("div",{className:"form-field"},c.a.createElement("input",{type:"text",name:"name",placeholder:"Your name",className:"NewCommentForm__input",value:E.name||o.name,onChange:l("name"),required:!0}),v.name&&c.a.createElement("p",{className:"NewCommentForm__error"},v.name)),c.a.createElement("div",{className:"form-field"},c.a.createElement("input",{type:"email",name:"email",placeholder:"Your email",className:"NewCommentForm__input",value:E.email||o.email,onChange:l("email")}),v.email&&c.a.createElement("p",{className:"NewCommentForm__error"},v.email)),c.a.createElement("div",{className:"form-field"},c.a.createElement("textarea",{name:"body",placeholder:"Type comments here",className:"NewCommentForm__input",value:E.body||o.body,required:!0,onChange:function(e){m("body",e.target.value)}}),v.body&&c.a.createElement("p",{className:"NewCommentForm__error"},v.body)),c.a.createElement("button",{type:"submit",className:"NewCommentForm__submit-button button"},p()?"Update a comment":"Add a comment"))})),le=(n(58),function(){var e=Object(s.c)(z),t=Object(s.c)(J),n=Object(s.c)($),r=Object(s.c)(L),o=Object(s.b)();Object(a.useEffect)((function(){e>0&&o(function(e){return function(t){Promise.all([h(e),j(e)]).then((function(e){t({type:"SET_POST",post:Object(O.a)(Object(O.a)({},e[0]),{},{commentsCount:e[1].length})})}),(function(t){console.error("Failed to fetch details of post ".concat(e,"."),t)}))}}(e))}),[e,o]);return c.a.createElement("div",{className:"PostDetails"},r?c.a.createElement("div",{className:"loading"}):e>0&&t?c.a.createElement("article",{className:"PostDetails__post"},c.a.createElement("h2",null,t.title),c.a.createElement("p",null,t.body),c.a.createElement("div",{className:"PostDetails__post-comments"},t.commentsCount>0&&c.a.createElement("button",{type:"button",className:"button",onClick:function(e){e.preventDefault(),o({type:"SET_COMMENTS_HIDDEN",commentsHidden:!n})}},n?"Show ":"Hide ","comments"),!n&&c.a.createElement(se,{postId:e}),c.a.createElement("div",{className:"PostDetails__form-wrapper"},c.a.createElement(ie,{postId:e})))):c.a.createElement("p",{className:"info"},"No post details"))}),me=function(){var e=Object(s.c)(L),t=Object(s.c)(R),n=Object(i.e)(),r=new URLSearchParams(n.search),o=Number(r.get("userId"))||0,u=Object(s.b)();return Object(a.useEffect)((function(){m("users").then((function(e){u({type:"SET_USERS",value:e})}))}),[u]),c.a.createElement("div",{className:"App"},c.a.createElement("header",{className:"App__header"},!t&&c.a.createElement(ee,null)),c.a.createElement("main",{className:"App__main"},c.a.createElement("div",{className:"App__sidebar"},c.a.createElement(ne,{loading:e,selectedUserId:o})),c.a.createElement("div",{className:"App__content"},c.a.createElement(le,null))),e?c.a.createElement("div",{className:"alert"},"Loading data..."):c.a.createElement("div",{className:t?"alert alert--error":"alert"},t||"Ready"))},de=function(){return c.a.createElement(s.a,{store:B},c.a.createElement(u.a,null,c.a.createElement(me,null)))};o.a.render(c.a.createElement(de,null),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.c3fe525b.chunk.js.map