(this["webpackJsonpreact_redux-list-of-posts"]=this["webpackJsonpreact_redux-list-of-posts"]||[]).push([[0],{32:function(e,t,n){e.exports=n.p+"static/media/delete.d4a3dcc3.svg"},33:function(e,t,n){e.exports=n.p+"static/media/edit.a5ec2c5e.svg"},35:function(e,t,n){e.exports=n(59)},43:function(e,t,n){},56:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){},59:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),o=n(15),s=n.n(o),r=n(3),l=n(17),u=(n(43),"https://mate.academy/students-api/"),m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return fetch(u+e,t).then((function(e){if(!e.ok)throw new Error("".concat(e.status,": ").concat(e.statusText));return e.json()}))};var i=n(6),d=n.n(i),p=n(10),f=n(14),E=n(29),b=n(30),O=n(1);function v(e){return m("posts/".concat(e))}function j(e){return m("comments?postId=".concat(e))}function _(e){return m("comments/".concat(e))}var h={posts:[],post:null,selectedPostId:0,userId:0,users:[]},S=function(e){return{type:"SET_POSTID",value:e}},g=function(e){return e.userId},N=function(e){return function(t){(function(e){return m(e?"posts?userId=".concat(e):"posts?id=87&id=88&id=89&id=90&id=91&id=92&id=93")})(e).then((function(e){t({type:"SET_POSTS",posts:e})}))}},T=n(34),y={comments:null,commentsEdit:[],commentEdit:null,commentsHidden:!1,commentsUpdated:!1},I=function(e){return{type:"SET_POST_COMMENTS",comments:e}},C=function(e){return{type:"SET_COMMENT_EDIT",commentEdit:e}},P=function(e){return{type:"SET_COMMENTS_UPDATED",commentsUpdated:e}},D=function(e){console.log("POST"),function(e){m("comments",{method:"POST",headers:{"Content-type":"application/json; charset=UTF-8"},body:JSON.stringify(e)})}(e)},w=function(e,t){console.log("PATCH"),function(e,t){m("comments/".concat(e),{method:"PATCH",headers:{"Content-type":"application/json; charset=UTF-8"},body:JSON.stringify(t)})}(e,t)},M=function(e){console.log("DELETE",e),function(e){m("comments/".concat(e),{method:"DELETE"})}(e)},x=function(e,t){return e?e.map((function(e){return e.id!==t.id?t:Object(O.a)({},e)})):null},U=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"START_LOADING":return!0;case"FINISH_LOADING":return!1;default:return e}},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MESSAGE":return t.message;default:return e}},A=Object(f.combineReducers)({loading:U,message:k,postsState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USERID":return Object(O.a)(Object(O.a)({},e),{},{userId:t.value});case"SET_USERS":return Object(O.a)(Object(O.a)({},e),{},{users:t.value});case"SET_POSTS":return Object(O.a)(Object(O.a)({},e),{},{posts:t.posts});case"SET_POST":return Object(O.a)(Object(O.a)({},e),{},{post:t.post});case"SET_POSTID":return Object(O.a)(Object(O.a)({},e),{},{selectedPostId:t.value});default:return e}},commentsState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_POST_COMMENTS":return Object(O.a)(Object(O.a)({},e),{},{comments:t.comments});case"SET_COMMENTS_EDIT":return console.log("11 action.commentId",t.commentId),Object(O.a)(Object(O.a)({},e),{},{commentsEdit:[].concat(Object(T.a)(e.commentsEdit),[t.commentId])});case"SET_COMMENT_EDIT":return console.log("commentEdit",t.commentEdit),Object(O.a)(Object(O.a)({},e),{},{commentEdit:t.commentEdit});case"SET_NEW_COMMENT":return Object(O.a)(Object(O.a)({},e),{},{comments:x(e.comments,t.comment)});case"SET_COMMENTS_HIDDEN":return console.log(t.commentsHidden,"action.commentsHidden"),Object(O.a)(Object(O.a)({},e),{},{commentsHidden:t.commentsHidden});case"SET_COMMENTS_UPDATED":return Object(O.a)(Object(O.a)({},e),{},{commentsUpdated:t.commentsUpdated});default:return e}}}),L=function(e){return e.loading},H=function(e){return e.message},F=function(e){return e.postsState.users},R=function(e){return e.postsState.posts},J=function(e){return e.postsState.selectedPostId},q=function(e){return e.postsState.post},G=function(e){return e.commentsState.comments},W=function(e){return e.commentsState.commentsEdit},Y=function(e){return e.commentsState.commentEdit},B=function(e){return e.commentsState.commentsHidden},z=function(e){return e.commentsState.commentsUpdated},K=Object(f.createStore)(A,Object(E.composeWithDevTools)(Object(f.applyMiddleware)(b.a))),Q=n(20),V=n(4),X=n(31),Z=n.n(X),$=function(){var e=Object(a.useState)(""),t=Object(Q.a)(e,2),n=t[0],o=t[1],s=Object(V.e)(),l=Object(V.d)(),u=new URLSearchParams(s.search),m=Object(r.c)(g),i=Object(r.c)(F),d=Object(r.b)(),p=Object(a.useCallback)(Z()((function(e){e?u.set("query",e):u.delete("query"),l.push({search:u.toString()})}),350),[]),f=Object(a.useCallback)((function(e){var t=e.currentTarget.value;Number(t)>0?(u.set("userId",t),d(function(e){return{type:"SET_USERID",value:e}}(Number(t)))):u.delete("userId"),l.push({search:u.toString()})}),[m,d]);return i?c.a.createElement(c.a.Fragment,null,c.a.createElement("label",null,"Title: \xa0",c.a.createElement("input",{type:"text",name:"title",value:n,placeholder:"Filter by title",className:"App__header-filter",onChange:function(e){var t=e.currentTarget.value;o(t),p(t)}})),c.a.createElement("label",null,"Select a user: \xa0",c.a.createElement("select",{name:"user",className:"App__user-selector",value:m,onChange:f},c.a.createElement("option",{value:""},"Choose a user"),i.map((function(e){return c.a.createElement("option",{value:e.id,key:e.id},e.name)}))))):c.a.createElement("div",{className:"App__loading-message"},"Loading data...")},ee=(n(56),function(){var e=Object(r.c)(R),t=Object(r.c)(J),n=Object(V.e)(),o=new URLSearchParams(n.search),s=Number(o.get("userId"))||0,l=o.get("query")||null,u=Object(r.b)();Object(a.useEffect)((function(){s>0?(console.log("userId and selectedUserId in useEffect 1",s),u(N(s))):(console.log("userId and selectedUserId in useEffect 2",s),u(N()))}),[s,u]);var m=l?e.filter((function(e){return e.title.includes(l.toLowerCase())})):e,i=!e||!e.length;return console.log("filteredPosts.length",m.length),c.a.createElement("div",{className:"PostsList"},i?c.a.createElement("p",{className:"info"},"Posts list is empty."):c.a.createElement(c.a.Fragment,null,c.a.createElement("h2",null,"Posts:"),c.a.createElement("ul",{className:"PostsList__list"},m.map((function(e){return c.a.createElement("li",{className:"PostsList__item",key:e.id},c.a.createElement("div",{className:"PostsList__item-content"},c.a.createElement("h3",null,e.title),c.a.createElement("p",null,e.body)),t!==e.id?c.a.createElement("button",{type:"button",className:"PostsList__button button",onClick:function(){u(S(e.id))}},"Open"):c.a.createElement("button",{type:"button",className:"PostsList__button button button--active",onClick:function(){u(S(0)),u(I(null))}},"Close"))})))))}),te=n(32),ne=n.n(te),ae=n(33),ce=n.n(ae),oe=c.a.memo((function(e){var t=e.postId,n=Object(r.c)(G),o=Object(r.c)(z),s=Object(r.c)(W),l=Object(r.b)();Object(a.useEffect)((function(){t>0&&(l(function(e){return function(t){j(e).then((function(e){t(I(e||null))}))}}(t)),console.log("Comments useeffect postId",t,o),l(C(null))),o&&(console.log("Comments commentsUpdated is true in useeffect",t,o),l(P(!1)))}),[t,o,l]);var u=function(){var e=Object(p.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t);case 2:l(P(!0));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=Object(p.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(t);case 2:n=e.sent,l(C(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return n?(console.log(n,"commentsEdit",s),c.a.createElement("ul",{className:"PostDetails__list"},n.map((function(e){return c.a.createElement("li",{className:"PostDetails__list-item",key:e.id},c.a.createElement("span",null,e.body," ",c.a.createElement("sub",null,e.id," post ",t)),c.a.createElement("div",null,s.includes(e.id)&&c.a.createElement("button",{type:"button",className:"button button--icon",onClick:function(t){t.preventDefault(),console.log("edit"),m(e.id)}},c.a.createElement("img",{src:ce.a,alt:"edit icon"})),c.a.createElement("button",{type:"button",className:"button button--icon",onClick:function(t){t.preventDefault(),e.id&&u(e.id)}},c.a.createElement("img",{src:ne.a,alt:"delete icon"}))))})))):c.a.createElement("p",{className:"info"},"No comments")})),se=n(18),re=(n(57),c.a.memo((function(e){var t=e.postId,n={name:"",email:"",body:"",postId:t},o=Object(a.useState)(n),s=Object(Q.a)(o,2),l=s[0],u=s[1],m=Object(r.c)(Y),i=Object(r.b)();Object(a.useEffect)((function(){m?(console.log(111),u(Object(O.a)(Object(O.a)({},n),{},{name:m.name,email:m.email,body:m.body}))):(console.log(222),u(n))}),[t,m]);var f=function(e){var t=e.target,n=t.name,a=t.value;u((function(e){return Object(O.a)(Object(O.a)({},e),{},Object(se.a)({},n,a))}))},E=function(){var e=Object(p.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(O.a)(Object(O.a)({},t),{},{id:m.id}),console.log("Comment that has edited is ",n,m.id),e.next=4,w(m.id,n);case 4:i(P(!0));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=Object(p.a)(d.a.mark((function e(t){var n,a,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now().toString(),a=Number(n.substr(n.length-6)),c=Object(O.a)(Object(O.a)({},t),{},{id:a}),console.log("new comment is ",c),e.next=6,D(c);case 6:i(P(!0)),i({type:"SET_COMMENTS_EDIT",commentId:a});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return c.a.createElement("form",{className:"NewCommentForm",onSubmit:function(e){e.preventDefault(),!0===function(e){var t=!0;return e.name.length||(t=!1),t}(l)?(m?E(l):b(l),u(n),u({name:"",email:"",body:"",postId:t})):console.log("Write message")},method:"POST"},c.a.createElement("div",{className:"form-field"},c.a.createElement("input",{type:"text",name:"name",placeholder:"Your name",className:"NewCommentForm__input",value:l.name,onChange:f})),c.a.createElement("div",{className:"form-field"},c.a.createElement("input",{type:"text",name:"email",placeholder:"Your email",className:"NewCommentForm__input",value:l.email,onChange:f})),c.a.createElement("div",{className:"form-field"},c.a.createElement("textarea",{name:"body",placeholder:"Type comments here",className:"NewCommentForm__input",value:l.body,onChange:f})),c.a.createElement("button",{type:"submit",className:"NewCommentForm__submit-button button"},"Add a comment"))}))),le=(n(58),function(){var e=Object(r.c)(J),t=Object(r.c)(q),n=Object(r.c)(B),o=Object(r.b)();Object(a.useEffect)((function(){e>0&&o(function(e){return function(t){Promise.all([v(e),j(e)]).then((function(e){t({type:"SET_POST",post:Object(O.a)(Object(O.a)({},e[0]),{},{commentsCount:e[1].length})})}),(function(t){console.error("Failed to fetch details of post ".concat(e,"."),t)}))}}(e))}),[e,o]);return console.log("ccc",n,t),c.a.createElement("div",{className:"PostDetails"},e>0&&t?c.a.createElement("article",{className:"PostDetails__post"},c.a.createElement("h2",null,t.title),c.a.createElement("p",null,t.body),c.a.createElement("div",{className:"PostDetails__post-comments"},t.commentsCount>0&&c.a.createElement("button",{type:"button",className:"button",onClick:function(e){e.preventDefault(),o({type:"SET_COMMENTS_HIDDEN",commentsHidden:!n})}},n?"Show ":"Hide ","comments"),!n&&c.a.createElement(oe,{postId:e}),c.a.createElement("div",{className:"PostDetails__form-wrapper"},c.a.createElement(re,{postId:e})))):c.a.createElement("p",{className:"info"},"No post details"))}),ue=function(){var e=Object(r.c)(L),t=Object(r.c)(H)||"Ready!",n=Object(r.b)();return Object(a.useEffect)((function(){m("users").then((function(e){return n({type:"SET_USERS",value:e})}))}),[n]),c.a.createElement("div",{className:"App"},c.a.createElement("header",{className:"App__header"},c.a.createElement($,null)),c.a.createElement("main",{className:"App__main"},c.a.createElement("div",{className:"App__sidebar"},c.a.createElement(ee,null)),c.a.createElement("div",{className:"App__content"},c.a.createElement(le,null))),e?c.a.createElement("div",{className:"alert"},"'Loading...'"):c.a.createElement("div",{className:"alert alert--fade-out"},t))},me=function(){return c.a.createElement(r.a,{store:K},c.a.createElement(l.a,null,c.a.createElement(ue,null)))};s.a.render(c.a.createElement(me,null),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.6d75face.chunk.js.map