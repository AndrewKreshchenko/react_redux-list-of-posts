(this["webpackJsonpreact_redux-list-of-posts"]=this["webpackJsonpreact_redux-list-of-posts"]||[]).push([[0],{32:function(e,t,n){e.exports=n.p+"static/media/delete.d4a3dcc3.svg"},33:function(e,t,n){e.exports=n.p+"static/media/edit.a5ec2c5e.svg"},35:function(e,t,n){e.exports=n(59)},43:function(e,t,n){},56:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){},59:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(17),o=n.n(r),s=n(2),u=n(19),l=(n(43),"https://mate.academy/students-api/"),i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return fetch(l+e,t).then((function(e){if(!e.ok)throw new Error("".concat(e.status,": ").concat(e.statusText));return e.json()}))};var m=n(6),d=n.n(m),p=n(10),b=n(16),f=n(29),E=n(30),v=n(1);function O(e){return i("posts/".concat(e))}function h(e){return i("comments?postId=".concat(e))}var S=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"START_LOADING":return!0;case"FINISH_LOADING":return!1;default:return e}},j={posts:[],post:null,selectedPostId:0,userId:0,users:[]},_=function(e){return{type:"SET_USERID",value:e}},N=function(e){return{type:"SET_POSTID",value:e}},T=function(e){return function(t){t({type:"START_LOADING"}),function(e){return i(e?"posts?userId=".concat(e):"posts")}(e).then((function(e){t({type:"SET_POSTS",posts:e}),t({type:"FINISH_LOADING"})}))}},g=n(34),y={comments:null,commentsEdit:[],commentEdit:null,commentsHidden:!1,commentsUpdated:!1},I=function(e){return{type:"SET_POST_COMMENTS",comments:e}},C=function(e){return{type:"SET_COMMENT_EDIT",commentEdit:e}},D=function(e){return{type:"SET_COMMENTS_UPDATED",commentsUpdated:e}},P=function(e){!function(e){i("comments",{method:"POST",headers:{"Content-type":"application/json; charset=UTF-8"},body:JSON.stringify(e)})}(e)},w=function(e,t){!function(e,t){i("comments/".concat(e),{method:"PATCH",headers:{"Content-type":"application/json; charset=UTF-8"},body:JSON.stringify(t)})}(e,t)},A=function(e){!function(e){i("comments/".concat(e),{method:"DELETE"})}(e)},M=function(e,t){return e?e.map((function(e){return e.id!==t.id?t:Object(v.a)({},e)})):null},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MESSAGE":return t.message;default:return e}},L=Object(b.combineReducers)({loading:S,message:x,postsState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USERID":return Object(v.a)(Object(v.a)({},e),{},{userId:t.value});case"SET_USERS":return Object(v.a)(Object(v.a)({},e),{},{users:t.value});case"SET_POSTS":return Object(v.a)(Object(v.a)({},e),{},{posts:t.posts});case"SET_POST":return Object(v.a)(Object(v.a)({},e),{},{post:t.post});case"SET_POSTID":return Object(v.a)(Object(v.a)({},e),{},{selectedPostId:t.value});default:return e}},commentsState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_POST_COMMENTS":return Object(v.a)(Object(v.a)({},e),{},{comments:t.comments});case"SET_COMMENTS_EDIT":return Object(v.a)(Object(v.a)({},e),{},{commentsEdit:[].concat(Object(g.a)(e.commentsEdit),[t.commentId])});case"SET_COMMENT_EDIT":return Object(v.a)(Object(v.a)({},e),{},{commentEdit:t.commentEdit});case"SET_NEW_COMMENT":return Object(v.a)(Object(v.a)({},e),{},{comments:M(e.comments,t.comment)});case"SET_COMMENTS_HIDDEN":return Object(v.a)(Object(v.a)({},e),{},{commentsHidden:t.commentsHidden});case"SET_COMMENTS_UPDATED":return Object(v.a)(Object(v.a)({},e),{},{commentsUpdated:t.commentsUpdated});default:return e}}}),F=function(e){return e.loading},k=function(e){return e.message},U=function(e){return e.postsState.users},H=function(e){return e.postsState.userId},R=function(e){return e.postsState.posts},G=function(e){return e.postsState.selectedPostId},q=function(e){return e.postsState.post},z=function(e){return e.commentsState.comments},J=function(e){return e.commentsState.commentsEdit},V=function(e){return e.commentsState.commentEdit},Y=function(e){return e.commentsState.commentsHidden},Z=function(e){return e.commentsState.commentsUpdated},$=Object(b.createStore)(L,Object(f.composeWithDevTools)(Object(b.applyMiddleware)(E.a))),W=n(15),B=n(4),K=n(31),Q=n.n(K),X=function(){var e=Object(a.useState)(""),t=Object(W.a)(e,2),n=t[0],r=t[1],o=Object(B.e)(),u=Object(B.d)(),l=new URLSearchParams(o.search),i=Object(s.c)(H),m=Object(s.c)(U),d=Object(s.c)(F),p=Object(s.b)(),b=Object(a.useCallback)(Q()((function(e){e&&e.length>0?l.set("query",e):l.delete("query"),u.push({search:l.toString()})}),350),[]),f=Object(a.useCallback)((function(e){var t=e.currentTarget.value;Number(t)>0&&t.length>0?(l.set("userId",t),p(_(Number(t)))):(l.delete("userId"),p(_(0))),u.push({search:l.toString()})}),[i,p]);return m?c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"group group--left"},c.a.createElement("label",{htmlFor:"title"},"Title: \xa0"),c.a.createElement("input",{type:"text",name:"title",value:n,placeholder:"Filter by title",onChange:function(e){var t=e.currentTarget.value;r(t),b(t)}})),d?c.a.createElement("div",{className:"info"},"Loading users..."):c.a.createElement("div",{className:"group group--left"},c.a.createElement("label",{htmlFor:"user"},"Select a user: \xa0"),c.a.createElement("select",{name:"user",value:i,onChange:f},c.a.createElement("option",{value:""},"Choose a user"),m.map((function(e){return c.a.createElement("option",{value:e.id,key:e.id},e.name)}))))):c.a.createElement("div",{className:"App__loading-message"},"Loading data...")},ee=(n(56),function(){var e,t=Object(s.c)(R),n=Object(s.c)(G),r=Object(s.c)(F),o=Object(B.e)(),u=new URLSearchParams(o.search),l=Number(u.get("userId"))||0,i=u.get("query")||null,m=Object(s.b)();return Object(a.useEffect)((function(){m(l>0?T(l):T())}),[l,m]),e=i?t.filter((function(e){return e.title.includes(i.toLowerCase())})):t,c.a.createElement("div",{className:"PostsList"},r?c.a.createElement("div",{className:"loading"}):c.a.createElement(c.a.Fragment,null,c.a.createElement("h2",null,"Posts:"),c.a.createElement("ul",{className:"PostsList__list"},e.length>0?e.map((function(e){return c.a.createElement("li",{className:"PostsList__item",key:e.id},c.a.createElement("div",{className:"PostsList__item-content"},c.a.createElement("h3",null,e.title),c.a.createElement("p",null,e.body)),n!==e.id?c.a.createElement("button",{type:"button",className:"PostsList__button button",onClick:function(){m(N(e.id))}},"Open"):c.a.createElement("button",{type:"button",className:"PostsList__button button button--active",onClick:function(){m(N(0)),m(I(null))}},"Close"))})):c.a.createElement("p",{className:"info"},"Posts list is empty."))))}),te=n(32),ne=n.n(te),ae=n(33),ce=n.n(ae),re=c.a.memo((function(e){var t=e.postId,n=Object(s.c)(z),r=Object(s.c)(Z),o=Object(s.c)(J),u=Object(s.b)();Object(a.useEffect)((function(){t>0&&u(function(e){return function(t){h(e).then((function(e){t(I(e||null))}))}}(t)),o&&u(C(null)),r&&u(D(!1))}),[t,r,u]);var l=function(){var e=Object(p.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(t);case 2:u(D(!0));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(e){(function(e){return i("comments/".concat(e))})(e).then((function(e){u(C(e))}))};return n?c.a.createElement("ul",{className:"PostDetails__list"},n.map((function(e){return c.a.createElement("li",{className:"PostDetails__list-item",key:e.id},c.a.createElement("span",null,e.body," ",c.a.createElement("sub",null,e.id," post ",t)),c.a.createElement("div",null,o.includes(e.id)&&c.a.createElement("button",{type:"button",className:"button button--icon",onClick:function(t){t.preventDefault(),m(e.id)}},c.a.createElement("img",{src:ce.a,alt:"edit icon"})),c.a.createElement("button",{type:"button",className:"button button--icon",onClick:function(t){t.preventDefault(),e.id&&l(e.id)}},c.a.createElement("img",{src:ne.a,alt:"delete icon"}))))}))):c.a.createElement("p",{className:"info"},"No comments")})),oe=(n(57),n(13)),se=c.a.memo((function(e){var t=e.postId,n=Object(s.c)(V),r=Object(s.b)();Object(a.useEffect)((function(){n?(m.name=n.name,m.email=n.email,m.body=n.body):E()}),[t,n]);var o=function(e){var t=Object(a.useState)((null===e||void 0===e?void 0:e.initialValues)||{}),n=Object(W.a)(t,2),c=n[0],r=n[1],o=Object(a.useState)({}),s=Object(W.a)(o,2),u=s[0],l=s[1],i=!0,m=function(){var t=Object(p.a)(d.a.mark((function t(n){var a,r,o,s,u,m,p,b,f;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),!(a=null===e||void 0===e?void 0:e.validations)){t.next=8;break}for(o in r={},a)u=c[o],(null===(m=a[o])||void 0===m||null===(s=m.required)||void 0===s?void 0:s.value)&&!u&&(i=!1,r[o]=null===m||void 0===m||null===(p=m.required)||void 0===p?void 0:p.message),(null===(b=null===m||void 0===m?void 0:m.pattern)||void 0===b?void 0:b.value)&&!RegExp(b.value).test(u)&&(i=!1,r[o]=b.message),(null===(f=null===m||void 0===m?void 0:m.custom)||void 0===f?void 0:f.isValid)&&!f.isValid(u)&&(i=!1,r[o]=f.message);if(i){t.next=8;break}return l(r),t.abrupt("return");case 8:l({}),(null===e||void 0===e?void 0:e.onSubmit)&&e.onSubmit();case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{valid:i,data:c,handleChange:function(e){return function(t){var n=t.target.value;r(Object(v.a)(Object(v.a)({},c),{},Object(oe.a)({},e,n)))}},handleTextareaChange:function(e,t){r(Object(v.a)(Object(v.a)({},c),{},Object(oe.a)({},e,t)))},handleSubmit:m,errors:u}}({validations:{name:{pattern:{value:"^[A-Za-z]*$",message:"You're not allowed to use special characters or numbers in your name."}},email:{pattern:{value:"^[a-zA-Z0-9]+@[a-zA-Z0-9]+.[A-Za-z]+$",message:"Your email is not valid."}},body:{custom:{isValid:function(e){return e.length<151&&e.length>3},message:"The comment should have from 4 to 150 characters."}}},onSubmit:function(){var e=Object(v.a)(Object(v.a)({},f),{},{name:m.name,email:m.email,body:m.body.replace(/^\s+|\s+$/g,"")});n?O(e):h(e),E()}}),u=o.handleSubmit,l=o.handleChange,i=o.handleTextareaChange,m=o.data,b=o.errors,f={name:"",email:"",body:"",postId:t},E=function(){m.name="",m.email="",m.body=""},O=function(){var e=Object(p.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(v.a)(Object(v.a)({},t),{},{id:n.id}),e.next=3,w(n.id,a);case 3:r(D(!0));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=Object(p.a)(d.a.mark((function e(t){var n,a,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now().toString(),a=Number(n.substr(n.length-6)),c=Object(v.a)(Object(v.a)({},t),{},{id:a}),e.next=5,P(c);case 5:r(D(!0)),r({type:"SET_COMMENTS_EDIT",commentId:a});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return c.a.createElement("form",{className:"NewCommentForm",onSubmit:function(e){e.preventDefault(),u(e)},method:"POST"},c.a.createElement("div",{className:"form-field"},c.a.createElement("input",{type:"text",name:"name",placeholder:"Your name",className:"NewCommentForm__input",value:m.name||"",onChange:l("name"),required:!0}),b.name&&c.a.createElement("p",{className:"NewCommentForm__error"},b.name)),c.a.createElement("div",{className:"form-field"},c.a.createElement("input",{type:"email",name:"email",placeholder:"Your email",className:"NewCommentForm__input",value:m.email||"",onChange:l("email")}),b.email&&c.a.createElement("p",{className:"NewCommentForm__error"},b.email)),c.a.createElement("div",{className:"form-field"},c.a.createElement("textarea",{name:"body",placeholder:"Type comments here",className:"NewCommentForm__input",value:m.body||"",required:!0,onChange:function(e){i("body",e.target.value)}}),b.body&&c.a.createElement("p",{className:"NewCommentForm__error"},b.body)),c.a.createElement("button",{type:"submit",className:"NewCommentForm__submit-button button"},"Add a comment"))})),ue=(n(58),function(){var e=Object(s.c)(G),t=Object(s.c)(q),n=Object(s.c)(Y),r=Object(s.c)(F),o=Object(s.b)();Object(a.useEffect)((function(){e>0&&o(function(e){return function(t){t({type:"START_LOADING"}),Promise.all([O(e),h(e)]).then((function(e){t({type:"FINISH_LOADING"}),t({type:"SET_POST",post:Object(v.a)(Object(v.a)({},e[0]),{},{commentsCount:e[1].length})})}),(function(t){console.error("Failed to fetch details of post ".concat(e,"."),t)}))}}(e))}),[e,o]);return c.a.createElement("div",{className:"PostDetails"},r?c.a.createElement("div",{className:"loading"}):e>0&&t?c.a.createElement("article",{className:"PostDetails__post"},c.a.createElement("h2",null,t.title),c.a.createElement("p",null,t.body),c.a.createElement("div",{className:"PostDetails__post-comments"},t.commentsCount>0&&c.a.createElement("button",{type:"button",className:"button",onClick:function(e){e.preventDefault(),o({type:"SET_COMMENTS_HIDDEN",commentsHidden:!n})}},n?"Show ":"Hide ","comments"),!n&&c.a.createElement(re,{postId:e}),c.a.createElement("div",{className:"PostDetails__form-wrapper"},c.a.createElement(se,{postId:e})))):c.a.createElement("p",{className:"info"},"No post details"))}),le=function(){var e=Object(s.c)(F),t=Object(s.c)(k)||"Ready!",n=Object(s.b)();return Object(a.useEffect)((function(){n({type:"START_LOADING"}),i("users").then((function(e){n({type:"SET_USERS",value:e}),n({type:"FINISH_LOADING"})}))}),[n]),c.a.createElement("div",{className:"App"},c.a.createElement("header",{className:"App__header"},c.a.createElement(X,null)),c.a.createElement("main",{className:"App__main"},c.a.createElement("div",{className:"App__sidebar"},c.a.createElement(ee,null)),c.a.createElement("div",{className:"App__content"},c.a.createElement(ue,null))),e?c.a.createElement("div",{className:"alert"},"'Loading...'"):c.a.createElement("div",{className:"alert alert--fade-out"},t))},ie=function(){return c.a.createElement(s.a,{store:$},c.a.createElement(u.a,null,c.a.createElement(le,null)))};o.a.render(c.a.createElement(ie,null),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.6ec94627.chunk.js.map